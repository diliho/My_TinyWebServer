
原定时器模块基于链表实现，在大规模定时器管理或高并发业务场景下（尤其是高并发短链接），因链表操作的线性时间复杂度特性，存在性能瓶颈，导致服务器资源占用偏高、业务请求处理能力受限。

## 小根堆定时器设计
### 1. 核心结构
采用**小根堆（最小堆）** 替代传统链表，基于完全二叉树特性实现定时器管理：
- 堆中每个父节点的定时器超时时间 ≤ 子节点，堆顶始终为最早超时的定时器，便于快速获取超时任务；
- 依托`vector`容器存储堆节点，保证内存连续且访问高效，结合动态扩容机制适配不同规模需求；
- 定时器结构体新增`index`字段，记录节点在堆数组中的位置，避免节点查找时的遍历开销，提升操作效率。

### 2. 关键操作优化
- **添加定时器（add_timer）**：新节点插入堆尾后，通过“上浮”调整恢复堆结构，时间复杂度从线性降至对数级；
- **删除定时器（del_timer）**：利用`index`定位节点，与堆尾节点交换后通过“下沉”或“上浮”调整堆，避免全量遍历；
- **超时检查（tick）**：直接读取堆顶节点判断是否超时，无需遍历所有定时器，提升超时任务处理效率。


## 优化效果
1. **性能提升**：定时器核心操作（添加、删除）效率显著提升，大规模或高并发场景下的业务请求处理能力增强；
2. **资源优化**：CPU资源占用有效减少，避免因定时器操作导致的资源浪费，服务器可分配更多资源给核心业务；
3. **稳定性增强**：高并发场景下无请求阻塞或失败情况，定时器管理模块的鲁棒性提升，保障服务器长期稳定运行。


## 适用场景
- 高并发短连接业务（如HTTP短连接、API网关）；
- 大规模定时器管理场景（如百万级连接超时控制）；
- 对CPU资源敏感、需高效利用硬件性能的服务器环境。

